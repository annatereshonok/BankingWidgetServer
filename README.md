# Проект: Виджет для отображения последних банковских операций

## Описание проекта

Этот проект разрабатывается для IT-отдела крупного банка и представляет собой бэкенд-часть новой фичи для личного кабинета клиента. Виджет будет отображать несколько последних успешных банковских операций клиента. Проект реализован на Python с использованием менеджера зависимостей Poetry.

## Функциональность

На текущий момент в проекте реализованы следующие функции:

### 1. `get_mask_card_number`
Принимает на вход номер карты и возвращает его маску. Номер карты отображается в формате `XXXX XX** **** XXXX`, где видны первые 6 цифр и последние 4 цифры, а остальные символы заменены на звездочки. Номер разбит на блоки по 4 цифры, разделенные пробелами.

**Пример:**
```python
get_mask_card_number("1234567890123456")  # Возвращает "1234 56** **** 3456"
```

### 2. `get_mask_account`
Принимает на вход номер счета и возвращает его маску. Номер счета отображается в формате **XXXX, где видны только последние 4 цифры, а перед ними — две звездочки.

**Пример:**
```python
get_mask_account("1234567890")  # Возвращает "**7890"
```

### 3. `get_mask_account`
Принимает на вход номер счета и возвращает его маску. Номер счета отображается в формате **XXXX, где видны только последние 4 цифры, а перед ними — две звездочки.

**Пример:**
```python
mask_account_card("Счет 1234567890")  # Возвращает "Счет **7890"
mask_account_card("VISA 1234567890123456")  # Возвращает "VISA 1234 56** **** 3456"
```

### 4. `get_date`
Принимает на вход строку с датой в формате "2024-03-11T02:26:18.671407" и возвращает строку с датой в формате "ДД.ММ.ГГГГ".

**Пример:**
```python
get_date("2024-03-11T02:26:18.671407")  # Возвращает "11.03.2024"
```

### 5. `filter_by_state`
Принимает список словарей и опциональное значение для ключа state (по умолчанию `'EXECUTED'`). Функция возвращает новый список словарей, содержащий только те словари, у которых ключ state соответствует указанному значению.

**Пример:**
```python
filter_by_state([{"state": "EXECUTED"}, {"state": "PENDING"}])  # Возвращает [{"state": "EXECUTED"}]
```

### 6. `sort_by_date`
Принимает список словарей и необязательный параметр, задающий порядок сортировки (по умолчанию — убывание). Функция возвращает новый список, отсортированный по дате (date).

**Пример:**
```python
sort_by_date([{"date": "2024-03-11"}, {"date": "2024-03-10"}])  # Возвращает [{"date": "2024-03-11"}, {"date": "2024-03-10"}]
```

### 7. `filter_by_currency`
Принимает на вход список словарей, представляющих транзакции.
Функция возвращает итератор, который поочередно выдает транзакции, где валюта операции соответствует заданной (например, USD).

**Пример:**
```python
filter_by_currency([
        {
            "id": 939719570,
            "state": "EXECUTED",
            "date": "2018-06-30T02:08:58.425572",
            "operationAmount": {"amount": "9824.07", "currency": {"name": "USD", "code": "USD"}},
            "description": "Перевод организации",
            "from": "Счет 75106830613657916952",
            "to": "Счет 11776614605963066702",
        },
        {
            "id": 873106923,
            "state": "EXECUTED",
            "date": "2019-03-23T01:09:46.296404",
            "operationAmount": {"amount": "43318.34", "currency": {"name": "руб.", "code": "RUB"}},
            "description": "Перевод со счета на счет",
            "from": "Счет 44812258784861134719",
            "to": "Счет 74489636417521191160",
        }]) 
# Возвращает:
# {
#    "id": 939719570,
#    "state": "EXECUTED",
#    "date": "2018-06-30T02:08:58.425572",
#    "operationAmount": {"amount": "9824.07", "currency": {"name": "USD", "code": "USD"}},
#    "description": "Перевод организации",
#    "from": "Счет 75106830613657916952",
#    "to": "Счет 11776614605963066702",
# }
```

### 8. `transaction_descriptions`
Принимает список словарей с транзакциями и возвращает описание каждой операции по очереди.

**Пример:**
```python
filter_by_currency([
        {
            "id": 939719570,
            "state": "EXECUTED",
            "date": "2018-06-30T02:08:58.425572",
            "operationAmount": {"amount": "9824.07", "currency": {"name": "USD", "code": "USD"}},
            "description": "Перевод организации",
            "from": "Счет 75106830613657916952",
            "to": "Счет 11776614605963066702",
        },
        {
            "id": 873106923,
            "state": "EXECUTED",
            "date": "2019-03-23T01:09:46.296404",
            "operationAmount": {"amount": "43318.34", "currency": {"name": "руб.", "code": "RUB"}},
            "description": "Перевод со счета на счет",
            "from": "Счет 44812258784861134719",
            "to": "Счет 74489636417521191160",
        }]) 
# Возвращает:  
# "Перевод организации"
# "Перевод со счета на счет"
```

### 9. `card_number_generator`
Принимает начальное и конечное значения для генерации диапазона номеров.
Выдает номера банковских карт в формате `XXXX XXXX XXXX XXXX`, где `X`
 — цифра номера карты. Генератор может сгенерировать номера карт в заданном диапазоне от `0000 0000 0000 0001`
до `9999 9999 9999 9999`.


**Пример:**
```python
card_number_generator(1, 5)  
# Возвращает:
# 0000 0000 0000 0001
# 0000 0000 0000 0002
# 0000 0000 0000 0003
# 0000 0000 0000 0004
# 0000 0000 0000 0005
```
### 10. `log` (декоратор)
Этот декоратор позволяет записывать лог-сообщения о запуске, успешном выполнении или ошибке функции. 
Логи могут быть записаны в консоль или в файл, в зависимости от указанных параметров.

Параметры:
- filename (необязательный) — путь к файлу, в который будут записываться логи. Если параметр не указан, логи будут выводиться в консоль.

Обработка исключений:
- Если в процессе выполнения функции возникнет исключение, оно будет залогировано с указанием типа ошибки, а сама ошибка будет снова выброшена.
## Установка

Для установки зависимостей используйте [Poetry](https://python-poetry.org/).

### 1. Убедитесь, что у вас установлен Python 3.8 или выше.

### 2. Установите Poetry, если он еще не установлен:
```bash
pip install poetry
```

### 3. Клонируйте репозиторий:
```bash
git clone https://github.com/annatereshonok/BankingWidgetServer.git
cd BankingWidgetServer
```

### 4. Установите зависимости:
```bash
poetry install
```

### 5. Активируйте виртуальное окружение:
```bash
poetry shell
```

## Структура проекта
```plaintext
bank-widget-backend/
├── src/
│   ├── __init__.py
│   ├── masks.py
│   ├── widget.py
│   ├── generators.py
│   ├── decorators.py
│   └── processing.py
├── tests/
│   ├── __init__.py
│   ├── confest.py
│   ├── test_masks.py
│   ├── test_widget.py
│   ├── test_generators.py
│   ├── test_decorators.py
│   └── test_processing.py
├── main.py
├── pyproject.toml
├── README.md
└── .gitignore
```

## Тестирование

Этот проект использует `pytest` для написания и запуска тестов.


## Запуск тестов

Для запуска всех тестов выполните следующую команду:

```sh
pytest
```

## Покрытие кода тестами

Для проверки покрытия кода тестами можно использовать `pytest-cov`:

```sh
pytest --cov=src
```

Где `src` — папка с исходным кодом.

## Логирование и отчеты

Для генерации HTML-отчёта о покрытии выполните:

```sh
pytest --cov=src --cov-report=html
```

## Лицензия

Этот проект распространяется под лицензией MIT. Подробнее см. в файле LICENSE.


